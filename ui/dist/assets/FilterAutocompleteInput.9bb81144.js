import{S as te,i as ne,s as ie,e as re,f as oe,g as se,y as _,o as ae,I as le,J as ue,K as ce,L as fe,C as L,M as de}from"./index.27866c98.js";import{C as E,E as C,a as q,h as he,b as ge,c as pe,d as ye,e as me,s as be,f as ke,g as xe,i as Ke,r as Ce,j as qe,k as we,l as Se,m as Le,n as Ee,o as Ie,p as Re,q as Ae,t as T,S as Be}from"./index.30b22912.js";function _e(e){z(e,"start");var i={},t=e.languageData||{},h=!1;for(var g in e)if(g!=t&&e.hasOwnProperty(g))for(var d=i[g]=[],s=e[g],o=0;o<s.length;o++){var a=s[o];d.push(new Oe(a,e)),(a.indent||a.dedent)&&(h=!0)}return{name:t.name,startState:function(){return{state:"start",pending:null,indent:h?[]:null}},copyState:function(l){var y={state:l.state,pending:l.pending,indent:l.indent&&l.indent.slice(0)};return l.stack&&(y.stack=l.stack.slice(0)),y},token:He(i),indent:De(i,t),languageData:t}}function z(e,i){if(!e.hasOwnProperty(i))throw new Error("Undefined state "+i+" in simple mode")}function ve(e,i){if(!e)return/(?:)/;var t="";return e instanceof RegExp?(e.ignoreCase&&(t="i"),e=e.source):e=String(e),new RegExp((i===!1?"":"^")+"(?:"+e+")",t)}function Me(e){if(!e)return null;if(e.apply)return e;if(typeof e=="string")return e.replace(/\./g," ");for(var i=[],t=0;t<e.length;t++)i.push(e[t]&&e[t].replace(/\./g," "));return i}function Oe(e,i){(e.next||e.push)&&z(i,e.next||e.push),this.regex=ve(e.regex),this.token=Me(e.token),this.data=e}function He(e){return function(i,t){if(t.pending){var h=t.pending.shift();return t.pending.length==0&&(t.pending=null),i.pos+=h.text.length,h.token}for(var g=e[t.state],d=0;d<g.length;d++){var s=g[d],o=(!s.data.sol||i.sol())&&i.match(s.regex);if(o){s.data.next?t.state=s.data.next:s.data.push?((t.stack||(t.stack=[])).push(t.state),t.state=s.data.push):s.data.pop&&t.stack&&t.stack.length&&(t.state=t.stack.pop()),s.data.indent&&t.indent.push(i.indentation()+i.indentUnit),s.data.dedent&&t.indent.pop();var a=s.token;if(a&&a.apply&&(a=a(o)),o.length>2&&s.token&&typeof s.token!="string"){t.pending=[];for(var l=2;l<o.length;l++)o[l]&&t.pending.push({text:o[l],token:s.token[l-1]});return i.backUp(o[0].length-(o[1]?o[1].length:0)),a[0]}else return a&&a.join?a[0]:a}}return i.next(),null}}function De(e,i){return function(t,h){if(t.indent==null||i.dontIndentStates&&i.doneIndentState.indexOf(t.state)>-1)return null;var g=t.indent.length-1,d=e[t.state];e:for(;;){for(var s=0;s<d.length;s++){var o=d[s];if(o.data.dedent&&o.data.dedentIfLineStart!==!1){var a=o.regex.exec(h);if(a&&a[0]){g--,(o.next||o.push)&&(d=e[o.next||o.push]),h=h.slice(a[0].length);continue e}}}break}return g<0?0:t.indent[g]}}function Fe(e){let i;return{c(){i=re("div"),oe(i,"class","code-editor")},m(t,h){se(t,i,h),e[17](i)},p:_,i:_,o:_,d(t){t&&ae(i),e[17](null)}}}function Ue(e){return JSON.stringify([e==null?void 0:e.type,e==null?void 0:e.schema])}function We(e,i,t){let h;le(e,ue,n=>t(16,h=n));const g=ce();let{id:d=""}=i,{value:s=""}=i,{disabled:o=!1}=i,{placeholder:a=""}=i,{baseCollection:l=null}=i,{singleLine:y=!1}=i,{extraAutocompleteKeys:I=[]}=i,{disableRequestKeys:k=!1}=i,{disableIndirectCollectionsKeys:K=!1}=i,f,m,R=o,v=new E,M=new E,O=new E,H=new E,x=[],D=[],F=[],U=[],w="",A="";function B(){f==null||f.focus()}function Q(n){let r=n.slice();return L.pushOrReplaceByKey(r,l,"id"),r}function W(){m==null||m.dispatchEvent(new CustomEvent("change",{detail:{value:s},bubbles:!0}))}function N(){if(!d)return;const n=document.querySelectorAll('[for="'+d+'"]');for(let r of n)r.removeEventListener("click",B)}function V(){if(!d)return;N();const n=document.querySelectorAll('[for="'+d+'"]');for(let r of n)r.addEventListener("click",B)}function S(n,r="",u=0){let p=x.find(b=>b.name==n||b.id==n);if(!p||u>=4)return[];let c=[r+"id",r+"created",r+"updated"];p.isAuth&&(c.push(r+"username"),c.push(r+"email"),c.push(r+"emailVisibility"),c.push(r+"verified"));for(const b of p.schema){const P=r+b.name;if(c.push(P),b.type==="relation"&&b.options.collectionId){const G=S(b.options.collectionId,P+".",u+1);G.length&&(c=c.concat(G))}}return c}function X(){return S(l==null?void 0:l.name)}function Y(){const n=[];n.push("@request.method"),n.push("@request.query."),n.push("@request.data."),n.push("@request.auth."),n.push("@request.auth.id"),n.push("@request.auth.collectionId"),n.push("@request.auth.collectionName"),n.push("@request.auth.verified"),n.push("@request.auth.username"),n.push("@request.auth.email"),n.push("@request.auth.emailVisibility"),n.push("@request.auth.created"),n.push("@request.auth.updated");const r=x.filter(u=>u.isAuth);for(const u of r){const p=S(u.id,"@request.auth.");for(const c of p)L.pushUnique(n,c)}return n}function Z(){const n=[];for(const r of x){const u="@collection."+r.name+".",p=S(r.name,u);for(const c of p)n.push(c)}return n}function j(n=!0,r=!0){let u=[].concat(I);return u=u.concat(U||[]),n&&(u=u.concat(D||[])),r&&(u=u.concat(F||[])),u.sort(function(p,c){return c.length-p.length}),u}function $(n){let r=n.matchBefore(/[\'\"\@\w\.]*/);if(r&&r.from==r.to&&!n.explicit)return null;let u=[{label:"false"},{label:"true"},{label:"@now"}];K||u.push({label:"@collection.*",apply:"@collection."});const p=j(!k,!k&&r.text.startsWith("@c"));for(const c of p)u.push({label:c.endsWith(".")?c+"*":c,apply:c});return{from:r.from,options:u}}function J(){return Be.define(_e({start:[{regex:/true|false|null/,token:"atom"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/\w+[\w\.]*\w+/,token:"keyword"},{regex:L.escapeRegExp("@now"),token:"keyword"},{regex:L.escapeRegExp("@request.method"),token:"keyword"}]}))}fe(()=>{const n={key:"Enter",run:r=>{y&&g("submit",s)}};return V(),t(11,f=new C({parent:m,state:q.create({doc:s,extensions:[he(),ge(),pe(),ye(),me(),q.allowMultipleSelections.of(!0),be(ke,{fallback:!0}),xe(),Ke(),Ce(),qe(),we.of([n,...Se,...Le,Ee.find(r=>r.key==="Mod-d"),...Ie,...Re]),C.lineWrapping,Ae({override:[$],icons:!1}),H.of(T(a)),M.of(C.editable.of(!o)),O.of(q.readOnly.of(o)),v.of(J()),q.transactionFilter.of(r=>y&&r.newDoc.lines>1?[]:r),C.updateListener.of(r=>{!r.docChanged||o||(t(1,s=r.state.doc.toString()),W())})]})})),()=>{N(),f==null||f.destroy()}});function ee(n){de[n?"unshift":"push"](()=>{m=n,t(0,m)})}return e.$$set=n=>{"id"in n&&t(2,d=n.id),"value"in n&&t(1,s=n.value),"disabled"in n&&t(3,o=n.disabled),"placeholder"in n&&t(4,a=n.placeholder),"baseCollection"in n&&t(5,l=n.baseCollection),"singleLine"in n&&t(6,y=n.singleLine),"extraAutocompleteKeys"in n&&t(7,I=n.extraAutocompleteKeys),"disableRequestKeys"in n&&t(8,k=n.disableRequestKeys),"disableIndirectCollectionsKeys"in n&&t(9,K=n.disableIndirectCollectionsKeys)},e.$$.update=()=>{e.$$.dirty[0]&65536&&t(13,x=Q(h)),e.$$.dirty[0]&32&&t(14,w=Ue(l)),e.$$.dirty[0]&49160&&!o&&A!=w&&(t(15,A=w),U=X()),e.$$.dirty[0]&8968&&!o&&(x!==-1||k!==-1||K!==-1)&&(D=k?[]:Y(),F=K?[]:Z()),e.$$.dirty[0]&4&&d&&V(),e.$$.dirty[0]&2080&&f&&(l==null?void 0:l.schema)&&f.dispatch({effects:[v.reconfigure(J())]}),e.$$.dirty[0]&6152&&f&&R!=o&&(f.dispatch({effects:[M.reconfigure(C.editable.of(!o)),O.reconfigure(q.readOnly.of(o))]}),t(12,R=o),W()),e.$$.dirty[0]&2050&&f&&s!=f.state.doc.toString()&&f.dispatch({changes:{from:0,to:f.state.doc.length,insert:s}}),e.$$.dirty[0]&2064&&f&&typeof a<"u"&&f.dispatch({effects:[H.reconfigure(T(a))]})},[m,s,d,o,a,l,y,I,k,K,B,f,R,x,w,A,h,ee]}class Je extends te{constructor(i){super(),ne(this,i,We,Fe,ie,{id:2,value:1,disabled:3,placeholder:4,baseCollection:5,singleLine:6,extraAutocompleteKeys:7,disableRequestKeys:8,disableIndirectCollectionsKeys:9,focus:10},null,[-1,-1])}get focus(){return this.$$.ctx[10]}}export{Je as default};
