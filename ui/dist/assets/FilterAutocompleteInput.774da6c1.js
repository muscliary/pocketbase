import{S as $,i as ee,s as te,e as ne,f as ie,g as oe,y as v,o as re,I as se,J as le,K as ce,L as ae,M as ue,C as L,N as fe}from"./index.786ddc4b.js";import{C as I,E as q,a as w,h as de,b as he,c as ge,d as pe,e as ye,s as me,f as be,g as ke,i as xe,r as Ke,j as qe,k as we,l as Ce,m as Se,n as Le,o as Ie,p as Ee,q as Re,t as T,S as ve}from"./index.30b22912.js";function Ae(n){G(n,"start");var i={},t=n.languageData||{},h=!1;for(var f in n)if(f!=t&&n.hasOwnProperty(f))for(var g=i[f]=[],l=n[f],r=0;r<l.length;r++){var s=l[r];g.push(new Me(s,n)),(s.indent||s.dedent)&&(h=!0)}return{name:t.name,startState:function(){return{state:"start",pending:null,indent:h?[]:null}},copyState:function(a){var y={state:a.state,pending:a.pending,indent:a.indent&&a.indent.slice(0)};return a.stack&&(y.stack=a.stack.slice(0)),y},token:Oe(i),indent:Fe(i,t),languageData:t}}function G(n,i){if(!n.hasOwnProperty(i))throw new Error("Undefined state "+i+" in simple mode")}function _e(n,i){if(!n)return/(?:)/;var t="";return n instanceof RegExp?(n.ignoreCase&&(t="i"),n=n.source):n=String(n),new RegExp((i===!1?"":"^")+"(?:"+n+")",t)}function Be(n){if(!n)return null;if(n.apply)return n;if(typeof n=="string")return n.replace(/\./g," ");for(var i=[],t=0;t<n.length;t++)i.push(n[t]&&n[t].replace(/\./g," "));return i}function Me(n,i){(n.next||n.push)&&G(i,n.next||n.push),this.regex=_e(n.regex),this.token=Be(n.token),this.data=n}function Oe(n){return function(i,t){if(t.pending){var h=t.pending.shift();return t.pending.length==0&&(t.pending=null),i.pos+=h.text.length,h.token}for(var f=n[t.state],g=0;g<f.length;g++){var l=f[g],r=(!l.data.sol||i.sol())&&i.match(l.regex);if(r){l.data.next?t.state=l.data.next:l.data.push?((t.stack||(t.stack=[])).push(t.state),t.state=l.data.push):l.data.pop&&t.stack&&t.stack.length&&(t.state=t.stack.pop()),l.data.indent&&t.indent.push(i.indentation()+i.indentUnit),l.data.dedent&&t.indent.pop();var s=l.token;if(s&&s.apply&&(s=s(r)),r.length>2&&l.token&&typeof l.token!="string"){t.pending=[];for(var a=2;a<r.length;a++)r[a]&&t.pending.push({text:r[a],token:l.token[a-1]});return i.backUp(r[0].length-(r[1]?r[1].length:0)),s[0]}else return s&&s.join?s[0]:s}}return i.next(),null}}function Fe(n,i){return function(t,h){if(t.indent==null||i.dontIndentStates&&i.doneIndentState.indexOf(t.state)>-1)return null;var f=t.indent.length-1,g=n[t.state];e:for(;;){for(var l=0;l<g.length;l++){var r=g[l];if(r.data.dedent&&r.data.dedentIfLineStart!==!1){var s=r.regex.exec(h);if(s&&s[0]){f--,(r.next||r.push)&&(g=n[r.next||r.push]),h=h.slice(s[0].length);continue e}}}break}return f<0?0:t.indent[f]}}function De(n){let i;return{c(){i=ne("div"),ie(i,"class","code-editor")},m(t,h){oe(t,i,h),n[15](i)},p:v,i:v,o:v,d(t){t&&re(i),n[15](null)}}}function Ue(n,i,t){let h,f,g;se(n,le,e=>t(14,g=e));const l=ce();let{id:r=""}=i,{value:s=""}=i,{disabled:a=!1}=i,{placeholder:y=""}=i,{baseCollection:m=new ae}=i,{singleLine:C=!1}=i,{extraAutocompleteKeys:E=[]}=i,{disableRequestKeys:x=!1}=i,{disableIndirectCollectionsKeys:K=!1}=i,d,b,A=new I,_=new I,B=new I,M=new I,O=[],F=[],D=[];function R(){d==null||d.focus()}function J(e){let o=e.slice();return L.pushOrReplaceByKey(o,m,"id"),o}function U(){b==null||b.dispatchEvent(new CustomEvent("change",{detail:{value:s},bubbles:!0}))}function W(){if(!r)return;const e=document.querySelectorAll('[for="'+r+'"]');for(let o of e)o.removeEventListener("click",R)}function H(){if(!r)return;W();const e=document.querySelectorAll('[for="'+r+'"]');for(let o of e)o.addEventListener("click",R)}function S(e,o="",c=0){let p=f.find(k=>k.name==e||k.id==e);if(!p||c>=4)return[];let u=[o+"id",o+"created",o+"updated"];p.isAuth&&(u.push(o+"username"),u.push(o+"email"),u.push(o+"emailVisibility"),u.push(o+"verified"));for(const k of p.schema){const V=o+k.name;if(u.push(V),k.type==="relation"&&k.options.collectionId){const P=S(k.options.collectionId,V+".",c+1);P.length&&(u=u.concat(P))}}return u}function z(){return S(m.name)}function Q(){const e=[];e.push("@request.method"),e.push("@request.query."),e.push("@request.data."),e.push("@request.auth."),e.push("@request.auth.id"),e.push("@request.auth.collectionId"),e.push("@request.auth.collectionName"),e.push("@request.auth.verified"),e.push("@request.auth.username"),e.push("@request.auth.email"),e.push("@request.auth.emailVisibility"),e.push("@request.auth.created"),e.push("@request.auth.updated");const o=f.filter(c=>c.isAuth);for(const c of o){const p=S(c.id,"@request.auth.");for(const u of p)L.pushUnique(e,u)}return e}function X(){const e=[];for(const o of f){const c="@collection."+o.name+".",p=S(o.name,c);for(const u of p)e.push(u)}return e}function Y(e=!0,o=!0){let c=[].concat(E);return c=c.concat(O),e&&(c=c.concat(F)),o&&(c=c.concat(D)),c.sort(function(p,u){return u.length-p.length}),c}function Z(e){let o=e.matchBefore(/[\'\"\@\w\.]*/);if(o&&o.from==o.to&&!e.explicit)return null;let c=[{label:"false"},{label:"true"},{label:"@now"}];K||c.push({label:"@collection.*",apply:"@collection."});const p=Y(!x,!x&&o.text.startsWith("@c"));for(const u of p)c.push({label:u.endsWith(".")?u+"*":u,apply:u});return{from:o.from,options:c}}function N(){return ve.define(Ae({start:[{regex:/true|false|null/,token:"atom"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/\w+[\w\.]*\w+/,token:"keyword"},{regex:L.escapeRegExp("@now"),token:"keyword"},{regex:L.escapeRegExp("@request.method"),token:"keyword"}]}))}ue(()=>{const e={key:"Enter",run:o=>{C&&l("submit",s)}};return H(),t(11,d=new q({parent:b,state:w.create({doc:s,extensions:[de(),he(),ge(),pe(),ye(),w.allowMultipleSelections.of(!0),me(be,{fallback:!0}),ke(),xe(),Ke(),qe(),we.of([e,...Ce,...Se,Le.find(o=>o.key==="Mod-d"),...Ie,...Ee]),q.lineWrapping,Re({override:[Z],icons:!1}),M.of(T(y)),_.of(q.editable.of(!0)),B.of(w.readOnly.of(!1)),A.of(N()),w.transactionFilter.of(o=>C&&o.newDoc.lines>1?[]:o),q.updateListener.of(o=>{!o.docChanged||a||(t(1,s=o.state.doc.toString()),U())})]})})),()=>{W(),d==null||d.destroy()}});function j(e){fe[e?"unshift":"push"](()=>{b=e,t(0,b)})}return n.$$set=e=>{"id"in e&&t(2,r=e.id),"value"in e&&t(1,s=e.value),"disabled"in e&&t(3,a=e.disabled),"placeholder"in e&&t(4,y=e.placeholder),"baseCollection"in e&&t(5,m=e.baseCollection),"singleLine"in e&&t(6,C=e.singleLine),"extraAutocompleteKeys"in e&&t(7,E=e.extraAutocompleteKeys),"disableRequestKeys"in e&&t(8,x=e.disableRequestKeys),"disableIndirectCollectionsKeys"in e&&t(9,K=e.disableIndirectCollectionsKeys)},n.$$.update=()=>{n.$$.dirty[0]&32&&t(13,h=m.type),n.$$.dirty[0]&16384&&t(12,f=J(g)),n.$$.dirty[0]&13056&&(h||f!==-1||x!==-1||K!==-1)&&(O=z(),F=x?[]:Q(),D=K?[]:X()),n.$$.dirty[0]&4&&r&&H(),n.$$.dirty[0]&2080&&d&&(m==null?void 0:m.schema)&&d.dispatch({effects:[A.reconfigure(N())]}),n.$$.dirty[0]&2056&&d&&typeof a<"u"&&(d.dispatch({effects:[_.reconfigure(q.editable.of(!a)),B.reconfigure(w.readOnly.of(a))]}),U()),n.$$.dirty[0]&2050&&d&&s!=d.state.doc.toString()&&d.dispatch({changes:{from:0,to:d.state.doc.length,insert:s}}),n.$$.dirty[0]&2064&&d&&typeof y<"u"&&d.dispatch({effects:[M.reconfigure(T(y))]})},[b,s,r,a,y,m,C,E,x,K,R,d,f,h,g,j]}class Ne extends ${constructor(i){super(),ee(this,i,Ue,De,te,{id:2,value:1,disabled:3,placeholder:4,baseCollection:5,singleLine:6,extraAutocompleteKeys:7,disableRequestKeys:8,disableIndirectCollectionsKeys:9,focus:10},null,[-1,-1])}get focus(){return this.$$.ctx[10]}}export{Ne as default};
